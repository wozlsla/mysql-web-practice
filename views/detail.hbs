<h1>
    {{ biz.icon }} {{ biz.business_name }}
</h1>

<table>
    <thead>
        <tr>
            <th colspan="2">
                ì—…ì†Œ ì •ë³´
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>ì„¹ì…˜</td>
            <td>{{ biz.section_name }} ({{ biz.floor }}ì¸µ)</td>
        </tr>
        <tr>
            <td>í˜„ì¬ ìƒíƒœ</td>
            <td>{{ biz.status_kor }}</td>
        </tr>
        <tr>
            <td>ë°°ë‹¬ ê°€ëŠ¥</td>
            <td>
                {{#if biz.can_takeout}}
                âœ”ï¸
                {{^}}
                âŒ
                {{/if}}
            </td>
        </tr>
    </tbody>
</table>

<br><br><br>

<h2>ğŸ“‹ ë©”ë‰´</h2>

<table>
    <thead>
        <tr>
            <th>ë©”ë‰´ëª…</th>
            <th>ê°€ê²©</th>
            <th>ì¹¼ë¡œë¦¬</th>
            <th>ì¢‹ì•„ìš”</th>
        </tr>
    </thead>
    <tbody>
        {{#each menus}}
        <tr>
            <td>{{ menu_name }}</td>
            <td>{{ price }}</td>
            <td>{{ kilocalories }}</td>
            <td>
                <span>{{ likes }}</span>
                <button class="small" onclick="putLike({{ menu_id }}, 1)">+</button>
                <button class="small" onclick="putLike({{ menu_id }}, -1)">-</button>
            </td>
        </tr>
        {{/each}}
    </tbody>
</table>

<br><br><br>

<h2>â­ í‰ì </h2>

<table>
    <thead>
        <tr>
            <th>í‰ì </th>
            <th>ì½”ë©˜íŠ¸</th>
            <th colspan="2">ì¼ì‹œ</th>
        </tr>
    </thead>
    <tbody>
        {{#each ratings}}
        <tr>
            <td>{{ stars }}</td>
            <td>{{ comment }}</td>
            <td>{{ created_fmt }}</td>
            <td>
                <button onclick="removeRating({{ rating_id }})">ì‚­ì œ</button>
            </td>
        </tr>
        {{/each}}
    </tbody>
</table>

<br>

<select id="stars">
    <option value="5">5ì </option>
    <option value="4">4ì </option>
    <option value="3">3ì </option>
    <option value="2">2ì </option>
    <option value="1">1ì </option>
</select>
<input id="comment" type="text">
<button onclick="addRating()">ì˜¬ë¦¬ê¸°</button>

<br><br><br>

<a href="/biz-simple?section=">
    â—€ï¸ ì—…ì†Œ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°ï¸
</a>

<script>
    function putLike(menu_id, like) {
        fetch(`/menus/${menu_id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                like: like
            })
        }).then((response) => response.json()).then(
            (data) => {
                if (data[0].affectedRows === 1) {
                    location.reload()
                } else {
                    alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
                }
            }
        )
    }

    function addRating() {
        fetch(`/ratings`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                business_id: {{ biz.business_id }},
            stars: document.getElementById('stars').value,
            comment: document.getElementById('comment').value,
      })
    }).then((response) => response.json()).then(
                (data) => {
                    console.log(data[0])
                    if (data[0].affectedRows === 1) {
                        location.reload()
                    } else {
                        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
                    }
                }
            )
  }

    function removeRating(rating_id) {
        if (!confirm('ì´ í‰ì ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return

        fetch(`/ratings/${rating_id}`, {
            method: 'DELETE'
        }).then((response) => response.json()).then(
            (data) => {
                console.log(data[0])
                if (data[0].affectedRows === 1) {
                    location.reload()
                } else {
                    alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
                }
            }
        )
    }
</script>